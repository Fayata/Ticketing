{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Portal Ticketing{% endblock %}

{% block nav_dashboard %}active{% endblock %}

{% block page_title %}Dashboard{% endblock %}
{% block page_subtitle %}Selamat datang kembali, {{ user.get_full_name|default:user.username }}!{% endblock %}

{% block content %}
<!-- Welcome Banner -->
<div class="welcome-banner">
    <div class="banner-content">
        <div class="banner-text">
            <h2>Butuh Bantuan?</h2>
            <p>Tim support kami siap membantu Anda 24/7. Buat tiket sekarang atau cari jawaban di Knowledge Base.</p>
            <div class="banner-actions">
                <a href="{% url 'create-ticket' %}" class="btn-white">Buat Tiket Baru</a>
                <a href="#" class="btn-outline">Lihat Knowledge Base</a>
            </div>
        </div>
        <div class="banner-icon">
            <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5" opacity="0.2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
        </div>
    </div>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-info">
                <p>Tiket Aktif</p>
                <h3>{{ active_tickets }}</h3>
            </div>
            <div class="stat-icon orange">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-info">
                <p>Dalam Progress</p>
                <h3>{{ in_progress_tickets }}</h3>
            </div>
            <div class="stat-icon red">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-info">
                <p>Tiket Selesai</p>
                <h3>{{ closed_tickets }}</h3>
            </div>
            <div class="stat-icon green">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-info">
                <p>Avg. Response</p>
                <h3>{{ avg_response_time }}</h3>
            </div>
            <div class="stat-icon red">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
            </div>
        </div>
    </div>
</div>

<!-- Main Grid -->
<div class="main-grid">
    <!-- Tickets List -->
    <div class="card">
        <div class="card-header">
            <h2>Tiket Saya</h2>
            <a href="{% url 'my-tickets' %}" class="view-all-link">
                Lihat Semua
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </a>
        </div>
        <div class="card-body">
            <div class="ticket-list">
                {% if recent_tickets %}
                    {% for ticket in recent_tickets %}
                    <div class="ticket-item" data-ticket-id="{{ ticket.id }}">
                        <div class="ticket-header">
                            <div>
                                <div class="ticket-id-status">
                                    <span class="ticket-id">#TKT-{{ ticket.id }}</span>
                                    <span class="status-badge {% if ticket.status == 'OPEN' %}open{% elif ticket.status == 'IN_PROGRESS' %}in-progress{% elif ticket.status == 'CLOSED' %}resolved{% endif %}">
                                        {{ ticket.get_status_display }}
                                    </span>
                                </div>
                                <h3 class="ticket-title">{{ ticket.title }}</h3>
                                <div class="ticket-meta">
                                    <span class="ticket-meta-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        </svg>
                                        {{ ticket.department.name|default:"Umum" }}
                                    </span>
                                    <span class="ticket-meta-item priority-{% if ticket.priority == 'HIGH' %}high{% elif ticket.priority == 'MEDIUM' %}medium{% else %}low{% endif %}">
                                        {{ ticket.get_priority_display }} Priority
                                    </span>
                                    <span class="ticket-meta-item">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                        </svg>
                                        {{ ticket.replies.count }} balasan
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="ticket-footer">
                            <span>Dibuat: {{ ticket.created_at|date:"d M Y, H:i" }}</span>
                            <span>Update terakhir: {{ ticket.updated_at|timesince }} lalu</span>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div style="text-align: center; padding: 3rem; color: #6b7280;">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin: 0 auto 1rem;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                        </svg>
                        <p style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">Belum ada tiket</p>
                        <p style="font-size: 0.875rem;">Buat tiket pertama Anda untuk mendapatkan bantuan</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <a href="{% url 'create-ticket' %}" class="quick-action-btn">
                <div class="quick-action-icon red">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </div>
                <p>Buat Tiket Baru</p>
            </a>
            <a href="#" class="quick-action-btn">
                <div class="quick-action-icon green">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    </svg>
                </div>
                <p>Lihat Semua Tiket</p>
            </a>
            <a href="#" class="quick-action-btn">
                <div class="quick-action-icon red">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    </svg>
                </div>
                <p>Knowledge Base</p>
            </a>
            <a href="#" class="quick-action-btn">
                <div class="quick-action-icon orange">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="23 7 16 12 23 17 23 7"></polygon>
                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                    </svg>
                </div>
                <p>Video Tutorial</p>
            </a>
        </div>
    </div>

    <!-- Sidebar Section -->
    <div class="sidebar-section">
        <!-- Announcements -->
        <div class="card">
            <div class="card-header">
                <h2>Pengumuman</h2>
            </div>
            <div class="card-body">
                {% if announcements %}
                    {% for announcement in announcements %}
                    <div class="announcement-item">
                        <div class="announcement-content">
                            <svg class="announcement-icon {% if announcement.type == 'WARNING' %}warning{% else %}info{% endif %}" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                            </svg>
                            <div class="announcement-text">
                                <h4>{{ announcement.title }}</h4>
                                <p>{{ announcement.description|truncatewords:20 }}</p>
                                <span>{{ announcement.created_at|timesince }} lalu</span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="announcement-item">
                        <div class="announcement-content">
                            <svg class="announcement-icon info" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                            <div class="announcement-text">
                                <h4>Selamat Datang!</h4>
                                <p>Selamat datang di sistem ticketing kami. Tim support siap membantu Anda 24/7.</p>
                                <span>Baru saja</span>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Knowledge Base -->
        <div class="card" style="margin-top: 1.5rem;">
            <div class="card-header">
                <h2>Artikel Populer</h2>
            </div>
            <div class="card-body">
                {% if popular_articles %}
                    {% for article in popular_articles %}
                    <div class="kb-item">
                        <div class="kb-content">
                            <div class="kb-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                </svg>
                            </div>
                            <div class="kb-text">
                                <h4>{{ article.title }}</h4>
                                <div class="kb-meta">
                                    <span>{{ article.category }}</span>
                                    <span>•</span>
                                    <span>{{ article.views }} views</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="kb-item">
                        <div class="kb-content">
                            <div class="kb-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                </svg>
                            </div>
                            <div class="kb-text">
                                <h4>Cara Membuat Tiket Baru</h4>
                                <div class="kb-meta">
                                    <span>Getting Started</span>
                                    <span>•</span>
                                    <span>0 views</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="kb-item">
                        <div class="kb-content">
                            <div class="kb-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                </svg>
                            </div>
                            <div class="kb-text">
                                <h4>FAQ - Pertanyaan Umum</h4>
                                <div class="kb-meta">
                                    <span>Account</span>
                                    <span>•</span>
                                    <span>0 views</span>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
            <div class="card-header" style="border-top: 1px solid var(--border-color); border-bottom: none;">
                <a href="#" class="view-all-link" style="margin: 0 auto;">
                    Lihat Semua Artikel
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}