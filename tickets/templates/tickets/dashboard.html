{% extends "dashboard_layout.html" %}
{% load static %}

{% block title %}Dashboard - Portal Ticketing{% endblock %}

{% block page_title %}Dashboard{% endblock %}
{% block page_subtitle %}Selamat datang kembali, {{ user.get_full_name|default:user.username }}!{% endblock %}

{% block content %}
<!-- Welcome Banner -->
<div class="welcome-banner">
    <div class="banner-content">
        <div class="banner-text">
            <h2>Butuh Bantuan?</h2>
            <p>Tim support kami siap membantu Anda 24/7. Buat tiket sekarang atau cari jawaban di Knowledge Base.</p>
            <div class="banner-actions">
                <a href="{% url 'create-ticket' %}" class="btn-white">Buat Tiket Baru</a>
                <a href="#" class="btn-outline-white">Lihat Knowledge Base</a>
            </div>
        </div>
    </div>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-info">
                <p>Tiket Aktif</p>
                <h3>{{ active_tickets }}</h3>
            </div>
            <div class="stat-icon orange">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-info">
                <p>Dalam Progress</p>
                <h3>{{ in_progress_tickets }}</h3>
            </div>
            <div class="stat-icon red">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-info">
                <p>Tiket Selesai</p>
                <h3>{{ closed_tickets }}</h3>
            </div>
            <div class="stat-icon green">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-info">
                <p>Avg. Response</p>
                <h3>{{ avg_response_time }}</h3>
            </div>
            <div class="stat-icon blue">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
            </div>
        </div>
    </div>
</div>

<!-- Main Grid -->
<div class="main-grid">
    <!-- Tickets List -->
    <div class="card">
        <div class="card-header">
            <h2>Tiket Terbaru</h2>
            <a href="{% url 'my-tickets' %}" class="view-all-link">
                Lihat Semua
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </a>
        </div>
        <div class="card-body" style="padding: 0;">
            {% if recent_tickets %}
            <div class="ticket-list">
                {% for ticket in recent_tickets %}
                <div class="ticket-item" onclick="window.location.href='{% url 'ticket-detail' ticket.id %}'">
                    <div class="ticket-header">
                        <div>
                            <div class="ticket-id-status" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <span style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary);">#TKT-{{ ticket.id }}</span>
                                <span class="status-badge {% if ticket.status == 'OPEN' %}open{% elif ticket.status == 'IN_PROGRESS' %}in-progress{% else %}closed{% endif %}">
                                    {{ ticket.get_status_display }}
                                </span>
                            </div>
                            <h3 style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">{{ ticket.title }}</h3>
                            <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; font-size: 0.875rem; color: var(--text-secondary);">
                                <span style="display: flex; align-items: center; gap: 0.375rem;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    </svg>
                                    {{ ticket.department.name|default:"Umum" }}
                                </span>
                                <span class="priority-{% if ticket.priority == 'HIGH' %}high{% elif ticket.priority == 'MEDIUM' %}medium{% else %}low{% endif %}">
                                    {{ ticket.get_priority_display }} Priority
                                </span>
                                <span style="display: flex; align-items: center; gap: 0.375rem;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                    </svg>
                                    {{ ticket.replies.count }} balasan
                                </span>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.75rem; font-size: 0.75rem; color: var(--text-light);">
                        <span>Dibuat: {{ ticket.created_at|date:"d M Y, H:i" }}</span>
                        <span>Update: {{ ticket.updated_at|timesince }} lalu</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                <h3>Belum ada tiket</h3>
                <p>Buat tiket pertama Anda untuk mendapatkan bantuan</p>
                <a href="{% url 'create-ticket' %}" class="btn-primary">Buat Tiket Pertama</a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Sidebar Section -->
    <div style="display: flex; flex-direction: column; gap: var(--spacing-lg);">
        <!-- Announcements -->
        <div class="card">
            <div class="card-header">
                <h2>Pengumuman</h2>
            </div>
            <div class="card-body" style="padding: 0;">
                <div style="padding: var(--spacing-md);">
                    <div style="display: flex; gap: var(--spacing-md); padding: var(--spacing-sm) 0;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--primary-red); flex-shrink: 0;">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <div>
                            <h4 style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary); margin-bottom: 0.25rem;">Selamat Datang!</h4>
                            <p style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Selamat datang di sistem ticketing kami. Tim support siap membantu Anda 24/7.</p>
                            <span style="font-size: 0.75rem; color: var(--text-light);">Baru saja</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Knowledge Base -->
        <div class="card">
            <div class="card-header">
                <h2>Artikel Populer</h2>
            </div>
            <div class="card-body" style="padding: 0;">
                <div style="padding: var(--spacing-sm);">
                    <div style="padding: var(--spacing-sm); cursor: pointer; border-radius: var(--radius-md); transition: var(--transition-fast);" 
                         onmouseover="this.style.background='var(--bg-hover)'" 
                         onmouseout="this.style.background='transparent'">
                        <div style="display: flex; gap: var(--spacing-md);">
                            <div style="width: 32px; height: 32px; background: var(--primary-red-pale); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: var(--primary-red); flex-shrink: 0;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary); margin-bottom: 0.25rem;">Cara Membuat Tiket Baru</h4>
                                <div style="display: flex; align-items: center; gap: var(--spacing-xs); font-size: 0.75rem; color: var(--text-light);">
                                    <span>Getting Started</span>
                                    <span>â€¢</span>
                                    <span>0 views</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}